---
import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  
  // Get unique categories from posts
  const categories = [...new Set(posts.map(post => post.data.category))];
  
  return categories.map((category) => ({
    params: { category },
    props: { category, posts: posts.filter(post => post.data.category === category) },
  }));
}

const { category, posts } = Astro.props;

// Sort posts by date (newest first)
const sortedPosts = posts.sort((a, b) => 
  new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
);

// Category metadata with SEO-optimized descriptions (under 160 chars)
const categoryInfo = {
  'recipes': { name: 'Recipes', color: 'secondary-500', description: 'Craft delicious mocktails and alcohol-free drinks at home. Expert bartender recipes with fresh ingredients and unique flavors.' },
  'tips': { name: 'Tips', color: 'accent-500', description: 'Practical tips for alcohol-free socializing. Navigate nightlife, handle social pressure, and find the best sober-friendly venues.' },
  'city-guide': { name: 'City Guides', color: 'accent-600', description: 'Explore the best alcohol-free bars, kava lounges, and mocktail spots in cities across America. Local recommendations.' },
  'wellness': { name: 'Wellness', color: 'primary-600', description: 'Discover health benefits of alcohol-free living. Mindfulness, mental clarity, better sleep, and holistic wellness.' },
  'community': { name: 'Community', color: 'primary-700', description: 'Stories of connection in alcohol-free spaces. How sober venues build real community and foster meaningful relationships.' },
  'delta-thc': { name: 'Delta THC', color: 'accent-700', description: 'Your guide to legal delta THC beverages and cannabis lounges. Safety tips, venue reviews, and responsible consumption.' },
  'advice': { name: 'Advice', color: 'secondary-600', description: 'Expert guidance on alcohol-free living from recovery coaches and wellness professionals. Your sober life questions answered.' },
} as const;

const info = categoryInfo[category as keyof typeof categoryInfo] || { name: category, color: 'primary-700', description: 'Blog posts in this category' };

// Category button styles for cross-linking
const categoryButtonStyles = {
  'recipes': 'border-secondary-500 text-secondary-500 hover:bg-secondary-500',
  'tips': 'border-accent-500 text-accent-500 hover:bg-accent-500',
  'city-guide': 'border-accent-600 text-accent-600 hover:bg-accent-600',
  'wellness': 'border-primary-600 text-primary-600 hover:bg-primary-600',
  'community': 'border-primary-700 text-primary-700 hover:bg-primary-700',
  'delta-thc': 'border-accent-700 text-accent-700 hover:bg-accent-700',
  'advice': 'border-secondary-600 text-secondary-600 hover:bg-secondary-600',
} as const;

// Get other categories for cross-linking (exclude current)
const allCategories = Object.entries(categoryInfo)
  .filter(([slug]) => slug !== category)
  .map(([slug, data]) => ({ slug, ...data, buttonStyle: categoryButtonStyles[slug as keyof typeof categoryButtonStyles] || '' }));
---

<Layout title={`${info.name} | Downtown Dry Blog`} description={info.description}>
  <!-- Hero Section -->
  <section class="py-24 bg-gradient-to-br from-neutral-900 via-primary-800 to-primary-700 text-white relative overflow-hidden">
    <div class="absolute inset-0 overflow-hidden">
      <div class="absolute -top-40 -right-40 w-80 h-80 bg-secondary-500/10 rounded-full blur-3xl animate-pulse"></div>
      <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-secondary-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>
    </div>
    
    <div class="relative max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-5xl md:text-6xl font-bold mb-8 leading-tight tracking-tight">{info.name.toUpperCase()}</h1>
      <p class="text-xl md:text-2xl text-neutral-100 leading-relaxed max-w-4xl mx-auto">
        {info.description}
      </p>
      <div class="mt-8 text-neutral-300">
        <span>{sortedPosts.length} {sortedPosts.length === 1 ? 'article' : 'articles'}</span>
      </div>
    </div>
  </section>
  
  <!-- Articles Grid -->
  <section class="py-20 bg-neutral-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      {sortedPosts.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {sortedPosts.map((post) => {
            // Define category styling
            let categoryClass = 'text-accent-500';
            let categoryText = post.data.category.replace('-', ' ').toUpperCase();
            
            switch(post.data.category) {
              case 'recipes':
                categoryClass = 'text-secondary-500';
                break;
              case 'wellness':
                categoryClass = 'text-primary-600';
                break;
              case 'city-guide':
                categoryClass = 'text-accent-600';
                break;
              case 'community':
                categoryClass = 'text-primary-700';
                break;
              case 'delta-thc':
                categoryClass = 'text-accent-700';
                break;
              case 'tips':
                categoryClass = 'text-accent-500';
                break;
              case 'advice':
                categoryClass = 'text-secondary-600';
                break;
            }
            
            return (
              <article class="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 flex flex-col">
                <Image src={post.data.image} alt={post.data.title} width={800} height={448} class="w-full h-56 object-cover block" />
                <div class="p-8 flex-1">
                  <div class={`text-sm ${categoryClass} font-semibold mb-3 uppercase tracking-wide`}>
                    {categoryText}
                  </div>
                  <h3 class="text-xl font-semibold mb-4 leading-tight">
                    <a href={`/blog/${post.slug}/`} class="hover:text-primary-700 transition-colors">
                      {post.data.title}
                    </a>
                  </h3>
                  <p class="text-neutral-700 mb-6 leading-relaxed">
                    {post.data.description}
                  </p>
                  <div class="flex items-center text-sm text-neutral-500">
                    <span>{post.data.publishDate.toLocaleDateString('en-US', { timeZone: 'UTC', year: 'numeric', month: 'long', day: 'numeric' })}</span>
                    <span class="mx-2">•</span>
                    <span>{post.data.readTime}</span>
                  </div>
                </div>
              </article>
            );
          })}
        </div>
      ) : (
        <div class="text-center py-20">
          <p class="text-xl text-neutral-700">No articles found in this category yet.</p>
          <a href="/blog/" class="mt-6 inline-block text-primary-700 font-semibold hover:text-primary-800 transition-colors">
            ← Back to Blog
          </a>
        </div>
      )}
    </div>
  </section>
  
  <!-- Browse Other Categories -->
  <section class="py-16 bg-neutral-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-2xl font-bold text-neutral-900 mb-8 text-center">Browse Other Categories</h2>
      <div class="flex flex-wrap justify-center gap-4">
        {allCategories.map((cat) => (
          <a
            href={`/blog/category/${cat.slug}/`}
            class={`px-6 py-3 rounded-full border-2 font-semibold hover:text-white transition-all duration-300 ${cat.buttonStyle}`}
          >
            {cat.name}
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Back to Blog -->
  <section class="py-12 bg-neutral-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <a href="/blog/" class="group inline-flex items-center text-primary-700 font-semibold text-lg hover:text-primary-800 transition-colors">
        <svg class="mr-2 w-5 h-5 group-hover:-translate-x-1 transition-transform" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
        </svg>
        BACK TO BLOG
      </a>
    </div>
  </section>
</Layout>
