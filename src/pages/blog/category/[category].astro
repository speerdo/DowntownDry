---
import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  
  // Get unique categories from posts
  const categories = [...new Set(posts.map(post => post.data.category))];
  
  return categories.map((category) => ({
    params: { category },
    props: { category, posts: posts.filter(post => post.data.category === category) },
  }));
}

const { category, posts } = Astro.props;

// Sort posts by date (newest first)
const sortedPosts = posts.sort((a, b) => 
  new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
);

// Category metadata with SEO-optimized descriptions (120-160 chars)
const categoryInfo = {
  'recipes': { name: 'Recipes', color: 'secondary-500', description: 'Craft delicious mocktails and alcohol-free drinks at home. Expert recipes from bartenders featuring fresh ingredients, unique flavors, and pro techniques.' },
  'tips': { name: 'Tips', color: 'accent-500', description: 'Practical tips for thriving in alcohol-free social settings. Navigate nightlife, handle social pressure, and discover the best sober-friendly venues near you.' },
  'city-guide': { name: 'City Guides', color: 'orange-500', description: 'Explore the best alcohol-free bars, kava lounges, and mocktail spots in cities across America. Local recommendations from people who know.' },
  'wellness': { name: 'Wellness', color: 'green-600', description: 'Discover the health benefits of alcohol-free living. Mindfulness practices, mental clarity, better sleep, and holistic wellness without the hangover.' },
  'community': { name: 'Community', color: 'blue-600', description: 'Stories of connection and belonging in alcohol-free spaces. How sober venues are building real community and fostering meaningful relationships.' },
  'delta-thc': { name: 'Delta THC', color: 'purple-600', description: 'Your guide to legal delta THC beverages and social cannabis lounges. Safety tips, venue reviews, and responsible consumption in social settings.' },
  'lifestyle': { name: 'Lifestyle', color: 'indigo-600', description: 'Embrace the alcohol-free lifestyle with confidence. From dating sober to hosting parties, discover how to live your best life without alcohol.' },
  'advice': { name: 'Advice', color: 'pink-600', description: 'Expert guidance on alcohol-free living from recovery coaches, therapists, and wellness professionals. Answers to your questions about sober life.' },
};

const info = categoryInfo[category] || { name: category, color: 'primary-700', description: 'Blog posts in this category' };

// Category button styles for cross-linking
const categoryButtonStyles = {
  'recipes': 'border-secondary-500 text-secondary-500 hover:bg-secondary-500',
  'tips': 'border-accent-500 text-accent-500 hover:bg-accent-500',
  'city-guide': 'border-orange-500 text-orange-500 hover:bg-orange-500',
  'wellness': 'border-green-600 text-green-600 hover:bg-green-600',
  'community': 'border-blue-600 text-blue-600 hover:bg-blue-600',
  'delta-thc': 'border-purple-600 text-purple-600 hover:bg-purple-600',
  'lifestyle': 'border-indigo-600 text-indigo-600 hover:bg-indigo-600',
  'advice': 'border-pink-600 text-pink-600 hover:bg-pink-600',
};

// Get other categories for cross-linking (exclude current)
const allCategories = Object.entries(categoryInfo)
  .filter(([slug]) => slug !== category)
  .map(([slug, data]) => ({ slug, ...data, buttonStyle: categoryButtonStyles[slug] || '' }));
---

<Layout title={`${info.name} | Downtown Dry Blog`} description={info.description}>
  <!-- Hero Section -->
  <section class="py-24 bg-gradient-to-br from-neutral-900 via-primary-800 to-primary-700 text-white relative overflow-hidden">
    <div class="absolute inset-0 overflow-hidden">
      <div class="absolute -top-40 -right-40 w-80 h-80 bg-secondary-500/10 rounded-full blur-3xl animate-pulse"></div>
      <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-secondary-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>
    </div>
    
    <div class="relative max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <div class={`inline-block text-sm text-${info.color} font-semibold mb-4 uppercase tracking-wide bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full`}>
        {info.name}
      </div>
      <h1 class="text-5xl md:text-6xl font-bold mb-8 leading-tight tracking-tight">{info.name.toUpperCase()}</h1>
      <p class="text-xl md:text-2xl text-neutral-100 leading-relaxed max-w-4xl mx-auto">
        {info.description}
      </p>
      <div class="mt-8 text-neutral-300">
        <span>{sortedPosts.length} {sortedPosts.length === 1 ? 'article' : 'articles'}</span>
      </div>
    </div>
  </section>
  
  <!-- Articles Grid -->
  <section class="py-20 bg-neutral-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      {sortedPosts.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {sortedPosts.map((post) => {
            // Define category styling
            let categoryClass = 'text-accent-500';
            let categoryText = post.data.category.replace('-', ' ').toUpperCase();
            
            switch(post.data.category) {
              case 'recipes':
                categoryClass = 'text-secondary-500';
                break;
              case 'wellness':
                categoryClass = 'text-green-600';
                break;
              case 'city-guide':
                categoryClass = 'text-orange-500';
                break;
              case 'community':
                categoryClass = 'text-blue-600';
                break;
              case 'lifestyle':
                categoryClass = 'text-indigo-600';
                break;
              case 'delta-thc':
                categoryClass = 'text-purple-600';
                break;
              case 'tips':
                categoryClass = 'text-accent-500';
                break;
              case 'advice':
                categoryClass = 'text-pink-600';
                break;
            }
            
            return (
              <article class="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 flex flex-col">
                <img src={post.data.image} alt={post.data.title} class="w-full h-56 object-cover block">
                <div class="p-8 flex-1">
                  <div class={`text-sm ${categoryClass} font-semibold mb-3 uppercase tracking-wide`}>
                    {categoryText}
                  </div>
                  <h3 class="text-xl font-semibold mb-4 leading-tight">
                    <a href={`/blog/${post.slug}`} class="hover:text-primary-700 transition-colors">
                      {post.data.title}
                    </a>
                  </h3>
                  <p class="text-neutral-700 mb-6 leading-relaxed">
                    {post.data.description}
                  </p>
                  <div class="flex items-center text-sm text-neutral-500">
                    <span>{post.data.publishDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                    <span class="mx-2">•</span>
                    <span>{post.data.readTime}</span>
                  </div>
                </div>
              </article>
            );
          })}
        </div>
      ) : (
        <div class="text-center py-20">
          <p class="text-xl text-neutral-700">No articles found in this category yet.</p>
          <a href="/blog/" class="mt-6 inline-block text-primary-700 font-semibold hover:text-primary-800 transition-colors">
            ← Back to Blog
          </a>
        </div>
      )}
    </div>
  </section>
  
  <!-- Browse Other Categories -->
  <section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-2xl font-bold text-neutral-900 mb-8 text-center">Browse Other Categories</h2>
      <div class="flex flex-wrap justify-center gap-4">
        {allCategories.map((cat) => (
          <a
            href={`/blog/category/${cat.slug}/`}
            class={`px-6 py-3 rounded-full border-2 font-semibold hover:text-white transition-all duration-300 ${cat.buttonStyle}`}
          >
            {cat.name}
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Back to Blog -->
  <section class="py-12 bg-neutral-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <a href="/blog/" class="group inline-flex items-center text-primary-700 font-semibold text-lg hover:text-primary-800 transition-colors">
        <svg class="mr-2 w-5 h-5 group-hover:-translate-x-1 transition-transform" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
        </svg>
        BACK TO BLOG
      </a>
    </div>
  </section>
</Layout>
